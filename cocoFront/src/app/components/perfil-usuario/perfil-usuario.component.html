<div id="one">
    <div class="container">
        <nav style="--bs-breadcrumb-divider:'>'">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a [routerLink]="['/home']">Home</a></li>
                <li class="breadcrumb-item">></li>
                <li class="breadcrumb-item active">Perfil de {{user?.username}}</li>
            </ol>
        </nav>

        <div class="user_info">
            <section class="info_box bg-light">

                <div class="text-center">
                    <h2 class="pt-5 fs-1">Perfil de {{user?.username}}</h2>
                </div>

                <!-- <div class="perfil_img d-flex flex-column pt-3">
                    <div class="text-center my-2">
                        <h3>{{user?.username}}</h3>
                    </div>
                    <figure>
                        <img [src]="user?.avatar" alt="user?.username">
                    </figure>
                    <div class="button_container text-center py-3">
                        <button class="btn btn-success" [routerLink]="['colecciones']">
                            Colecciones de {{user?.username}}
                        </button>
                    </div>
                </div> -->

                <div class="d-none d-lg-none user_actions_dropdown">
                    <div>
                        <button class="btn btn-success ms-3" type="button" data-bs-toggle="collapse"
                            data-bs-target="#menu_collapse">
                            Menu
                        </button>
                    </div>
                    <div class="collapse" id="menu_collapse">
                        <div class="card card-body">
                            <ul class="nav nav-tabs d-flex flex-column">
                                <li class="nav-item nav-link">Añadir a amigos</li>
                                <li class="nav-item nav-link">Contactar</li>
                                <li class="nav-item dropdown-divider"></li>
                                <li class="nav-item nav-link">Editar avatar</li>
                                <li class="nav-item nav-link">Editar bio</li>
                                <li class="nav-item nav-link">Editar login</li>
                                <li class="nav-item dropdown-divider"></li>
                                <li class="nav-item nav-link">Voto positivo</li>
                                <li class="nav-item nav-link">Voto negativo</li>
                                <li class="nav-item nav-link">Denunciar</li>
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="d-none d-lg-none user_actions_dropdown">
                    <div>
                        <button class="btn btn-success ms-3" type="button" data-bs-toggle="collapse"
                            data-bs-target="#menu_collapse">
                            Menu
                        </button>
                    </div>
                    <div class="collapse" id="menu_collapse">
                        <div class="card card-body">
                            <ul class="nav nav-tabs d-flex flex-column">
                                <li class="nav-item nav-link">Añadir a amigos</li>
                                <li class="nav-item nav-link">Enviar email</li>
                                <li class="nav-item dropdown-divider"></li>
                                <li class="nav-item nav-link">Voto positivo</li>
                                <li class="nav-item nav-link">Voto negativo</li>
                                <li class="nav-item nav-link">Denunciar</li>
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="info_eval">
                    <div class="info_top d-flex justify-content-center">

                        <div class="circle mt-4">
                            <div>
                                <i *ngIf="user?.trusted === 1" class="fa-solid fa-star trusted_star"></i>

                                <img [src]="user?.avatar" alt="user?.username">
                            </div>
                        </div>
                    </div>
                    <!-- <div class="info_text text-center my-4">
                        <p>
                            <strong>98%</strong>
                            de valoraciones positivas.
                        </p>
                    </div> -->
                    <div class="rating_text mt-3">
                        <ul class="d-flex justify-content-between">
                            <li class="positive">
                                <span>{{user?.rating}} Puntos <i class="fa-solid fa-star"></i></span>
                            </li>
                        </ul>
                        <p class="text-muted text-center small ps-3">* Valoraciones recibidas en los últimos 6 meses.
                        </p>
                    </div>
                </div>

                <div class="perfil_tabs mt-3">
                    <nav>
                        <ul class="nav nav-tabs mx-2">
                            <li class="nav-item nav-link" [ngClass]="{'active': profileTab === 'informacion'}"
                                (click)="cargarArticle('informacion')">
                                Información
                            </li>
                            <li class="nav-item nav-link" [ngClass]="{'active': profileTab === 'productos'}"
                                (click)="cargarArticle('productos')">
                                Productos
                            </li>
                            <li class="nav-item nav-link" [ngClass]="{'active': profileTab === 'colecciones'}"
                                (click)="cargarArticle('colecciones')">
                                Colecciones
                            </li>

                        </ul>
                    </nav>

                    <div class="content mb-5 pb-4">
                        <article *ngIf="profileTab === 'informacion'">

                            <div *ngIf="botonesOn">
                                <button class="btn btn-success ms-4 mt-4" type="button"
                                    [routerLink]="['/perfil', user?.id, 'edit', 'bio']">
                                    Editar datos
                                </button>
                                <!-- <button class="btn btn-primary w-25 mx-5 mt-3" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseExample">
                                    Editar info
                                </button> -->

                                <!-- <div class="collapse" id="collapseExample">

                                    <app-user-edit-bio-form></app-user-edit-bio-form>
                                    <div class="card card-body bg-light">
                                        <form class="w-25 my-3 mx-5 py-3 rounded-3" novalidate [formGroup]="userBioForm"
                                            (ngSubmit)="getDataForm(userBioForm)">

                                            <div class="form-floating">
                                                <input type="text" class="form-control" formControlName="nombre"
                                                    id="nombre" placeholder="">
                                                <label for="nombre">Nombre</label>
                                            </div>

                                            <div class="form-floating">
                                                <input type="text" class="form-control" formControlName="apellidos"
                                                    id="apellidos" placeholder="">
                                                <label for="apellidos">Apellidos</label>
                                            </div>

                                            <div class="form-floating">
                                                <input type="text" class="form-control" formControlName="discord"
                                                    id="discord" placeholder="">
                                                <label for="discord">Discord</label>
                                            </div>

                                            <div class="form-floating">
                                                <input type="text" class="form-control" formControlName="avatar"
                                                    id="avatar" placeholder="">
                                                <label for="avatar">Avatar</label>
                                            </div>

                                            <input class="btn btn-secondary w-25 my-3" type="submit" id="editar"
                                                value="Editar">
                                        </form>

                                    </div>
                                </div> -->


                            </div>

                            <div class="info_bio px-3">
                                <div class="mb-3 ps-3 pt-3">
                                    <strong>Nombre completo:</strong>
                                    <span>{{user?.nombre}} {{user?.apellidos}}</span>
                                </div>
                                <div class="my-3 ps-3">
                                    <strong>Email:</strong>
                                    <span>{{user?.email}}</span>
                                </div>
                                <div class="my-3 ps-3">
                                    <strong>Discord:</strong>
                                    <span><i class="fa-brands fa-discord"></i> {{user?.discord}} </span>
                                </div>
                                <div class="my-3 ps-3">
                                    <strong>Fecha de nacimiento:</strong>
                                    <span>{{user?.fecha_nacimiento | date:'dd MMMM YYYY'}} - {{userEdad}} años</span>
                                </div>
                                <div class="my-3 ps-3">
                                    <strong>Miembro desde:</strong>
                                    <span>{{user?.fecha_registro | date: 'dd MMMM YYYY'}} - {{userAntiguedad}}
                                        días</span>
                                </div>
                                <!-- <div class="my-3 ps-3">
                                    <strong>Última conexión:</strong>
                                    <span class="text-success">Online</span>
                                </div> -->

                                <div class="my-3">
                                    <strong class="ps-3">Ubicación:</strong>
                                    <span class="ps-3"><i class="fa fa-map-marker me-2"></i>{{user?.direccion}}</span>
                                    <!-- <input ngx-google-places-autocomplete [options]="options" #placesRef="ngx-places"
                                        (onAddressChange)="handleAddressChange($event)"> -->

                                    <div class="mapita">
                                        <agm-map [latitude]="lat" [longitude]="lng" [zoom]="zoom">
                                            <agm-marker [latitude]="lat" [longitude]="lng"></agm-marker>
                                        </agm-map>
                                    </div>
                                </div>

                            </div>
                        </article>


                        <article *ngIf="profileTab==='productos'">
                            <!-- nuevo producto modal y button -->
                            <div class="flex">
                                <button type="button" *ngIf="botonesOn" class="btn btn-success ms-4 mt-4 addProducto"
                                    data-bs-toggle="modal" data-bs-target="#nuevoProductoModal">
                                    Nuevo producto
                                </button>
                            </div>


                            <div class="modal fade" id="nuevoProductoModal" data-bs-backdrop="static"
                                data-bs-keyboard="true" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-xl modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <app-nuevo-producto></app-nuevo-producto>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="row g-4 p-4">
                                <div class="product-card col-12 col-md-6 col-lg-4"
                                    *ngFor="let producto of misProductos">
                                    <div class="card rounded-3">
                                        <div class="img card-img-top" [ngStyle]="{'background-image': 'url(' + producto.imagen
                                         + ')'}">
                                        </div>
                                        <div class="card-body">
                                            <h5 class="card-title"><strong>{{producto.nombre}}</strong></h5>
                                            <ul class="prod_caracteristicas mt-3 mb-3">

                                                <li *ngIf="producto.precio !== null">
                                                    <strong>Precio:</strong>
                                                    {{producto.precio}} €
                                                </li>

                                                <li *ngIf="producto.marca !== '' && producto.marca !== null">
                                                    <strong>Marca:</strong>
                                                    {{producto.marca | titlecase}}
                                                </li>

                                                <li *ngIf="producto.categoria !== null"><strong>Categoria:</strong>
                                                    {{producto.categoria | titlecase}}</li>
                                                <li *ngIf="producto.estado !== null"><strong>Estado:</strong>
                                                    {{producto.estado | titlecase}}</li>
                                            </ul>
                                            <h6> <strong>Descripcion:</strong></h6>
                                            <p>{{producto.descripcion}}</p>
                                            <div class="botonera mt-3 d-flex flex-column justify-content-around"
                                                *ngIf="botonesOn">
                                                <button
                                                    [routerLink]="['/perfil', user?.id, 'edit', 'producto', producto?.id ]"
                                                    type="button" class="btn btn-secondary mb-2" id="editBtn">
                                                    Editar
                                                </button>
                                                <button type="button" (click)="eliminarProd(producto.id)"
                                                    class="btn btn-danger mb-2" id="delete">
                                                    Eliminar
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </article>

                        <article *ngIf=" profileTab==='colecciones'">
                            <button type="button" *ngIf="botonesOn" class="btn btn-success ms-4 mt-4 addProducto"
                                [routerLink]="['/perfil', user?.id, 'nueva-coleccion']">
                                Nueva Colección</button>

                        </article>



                    </div>

                </div>
            </section>
        </div>
    </div>
</div>